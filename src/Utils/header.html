<!DOCTYPE html>
<html lang="en">

<!-- Basic -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Mobile Metas -->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Site Metas -->
<title>Group 4 - News</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">

<!-- Site Icons -->
<link rel="shortcut icon" href="../images/favicon.ico" type="../image/x-icon" />
<link rel="apple-touch-icon" href="../images/apple-touch-icon.png">

<!-- Design fonts -->
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="../css/bootstrap.css" rel="stylesheet">

<!-- FontAwesome Icons core CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Custom styles for this template -->
<link href="../css/style.css" rel="stylesheet">
<link href="../css/search.css" rel="stylesheet">

<!-- Responsive styles for this template -->
<link href="../css/responsive.css" rel="stylesheet">

<!-- Colors for this template -->
<link href="../css/colors.css" rel="stylesheet">

<!-- Version Tech CSS for this template -->
<link href="../css/version/tech.css" rel="stylesheet">

<style>
    .user-pic {
        width: 40px;
        border-radius: 50%;
        cursor: pointer;
    }

    .sub-menu-wrap {
        position: absolute;
        top: 90%;
        right: 0%;
        width: 230px;
        max-height: 0px;
        overflow: hidden;
        transition: max-height 0.5s;
    }

    .sub-menu-wrap.open-menu {
        max-height: 400px;
    }

    .sub-menu {
        background: #fff;
        padding: 20px;
        margin: 10px;
    }

    .sub-menu-link {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: #525252;
        margin: 12px 0;
    }

    .sub-menu-link p {
        width: 100%;
        margin-bottom: 0px;
    }

    .sub-menu-link img {
        width: 40px;
        background: #e5e5e5;
        border-radius: 50%;
        padding: 8px;
        margin-right: 15px;
    }

    .sub-menu-link span {
        font-size: 22px;
        transition: transform 0.5s;
    }

    .sub-menu-link:hover span {
        transform: translateX(5px);
        color: #525252;
        font-weight: 600;
    }

    .sub-menu-link:hover p {
        font-weight: 600;
    }
</style>

</head>

<body>
    <div id="wrapper">
        <header class="tech-header header">
            <div class="container-fluid">
                <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                        data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <a class="navbar-brand" href="../tech-index.html"><img src="../images/version/tech-logo.png"
                            alt=""></a>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <ul id="categories" class="navbar-nav mr-auto">
                        </ul>

                        <ul class="navbar-nav mr-2"
                            style="display: flex; align-items: center; justify-content: center;">
                            <li class="nav-item">
                                <div class="search">
                                    <div class="icon"></div>
                                    <div class="input">
                                        <form class="search-form">
                                            <input id="mysearch" type="text" placeholder="Search">
                                        </form>
                                    </div>
                                    <span class="clear"></span>
                                </div>
                            </li>
                        </ul>

                        <ul id="user-profile-location" class="navbar-nav mr-2 drop"
                            style="display: flex; align-items: center; justify-content: center;">
                            <li class="nav-item">
                                <a class="nav-link" href="../auth/login-form.html" style="padding-top: 0px!important;">
                                    <i class="fa-solid fa-right-to-bracket"></i> Login
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../auth/register-form.html"
                                    style="padding-top: 0px!important;">
                                    <i class="fa-solid fa-right-to-bracket"></i> Sign up
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div><!-- end container-fluid -->
        </header><!-- end market-header -->
    </div><!-- end wrapper -->

    <!-- Core JavaScript
================================================== -->
    <script src="../js/slim_notifier.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/tether.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/custom.js"></script>
    <script src="../js/search.js"></script>
    <script>
        $(document).ready(() => {
            var token = localStorage.getItem("token")
            var userProfile = $("#user-profile-location")
            if (token != null) {
                let decoded = jwt_decode(token);
                let userRole =
                    decoded[
                    "http://schemas.microsoft.com/ws/2008/06/identity/claims/role"
                    ];
                console.log(userRole)
                if (userRole == 0) {
                    userProfile.empty()
                    userProfile.append(
                        `<img src="../images/user.png" class="user-pic">
                        <div id="sub-menu" class="sub-menu-wrap">
                            <div class="sub-menu">
                                <a href="../admin/tech-user.html" class="sub-menu-link">
                                    <img src="../images/profile.png">
                                    <p>Management</p>
                                    <span>></span>
                                </a>
                                <a href="../tech-user-profile.html" class="sub-menu-link">
                                    <img src="../images/profile.png">
                                    <p>Profile</p>
                                    <span>></span>
                                </a>
                                <a href="#" id="logout-btn" class="sub-menu-link">
                                    <img src="../images/logout.png">
                                    <p>Logout</p>
                                    <span>></span>
                                </a>
                            </div>
                        </div>`

                    )
                } else if(userRole == 1){
                    userProfile.empty()
                    userProfile.append(
                    `<img src="../images/user.png" class="user-pic">
                        <div id="sub-menu" class="sub-menu-wrap">
                            <div class="sub-menu">
                                <a href="../Editor/Post-Management.html" class="sub-menu-link">
                                    <img src="../images/pencil.png">
                                    <p>Post Management</p>
                                    <span>></span>
                                </a>
                                <a href="../tech-user-profile.html" class="sub-menu-link">
                                    <img src="../images/profile.png">
                                    <p>Profile</p>
                                    <span>></span>
                                </a>
                                <a href="#" id="logout-btn" class="sub-menu-link">
                                    <img src="../images/logout.png">
                                    <p>Logout</p>
                                    <span>></span>
                                </a>
                            </div>
                        </div>`)
                }
                else if(userRole == 2){
                    userProfile.empty()
                    userProfile.append(
                    `<img src="../images/user.png" class="user-pic">
                        <div id="sub-menu" class="sub-menu-wrap">
                            <div class="sub-menu">
                                <a href="../Editor/Post-Writing.html" class="sub-menu-link">
                                    <img src="../images/pencil.png">
                                    <p>Writing</p>
                                    <span>></span>
                                </a>
                                <a href="../tech-user-profile.html" class="sub-menu-link">
                                    <img src="../images/profile.png">
                                    <p>Profile</p>
                                    <span>></span>
                                </a>
                                <a href="#" id="logout-btn" class="sub-menu-link">
                                    <img src="../images/logout.png">
                                    <p>Logout</p>
                                    <span>></span>
                                </a>
                            </div>
                        </div>`)
                }
                else {
                    userProfile.empty()
                    userProfile.append(
                        `<img src="../images/user.png" class="user-pic">
                        <div id="sub-menu" class="sub-menu-wrap">
                            <div class="sub-menu">
                                <a href="../tech-user-profile.html" class="sub-menu-link">
                                    <img src="../images/profile.png">
                                    <p>Profile</p>
                                    <span>></span>
                                </a>
                                <a href="../tech-bookmark.html" class="sub-menu-link">
                                    <img src="../images/bookmark.png">
                                    <p>Bookmark</p>
                                    <span>></span>
                                </a>
                                <a href="#" id="logout-btn" class="sub-menu-link">
                                    <img src="../images/logout.png">
                                    <p>Logout</p>
                                    <span>></span>
                                </a>
                            </div>
                        </div>`
                    )
                }
            }

            $(".user-pic").click(() => {
                $("#sub-menu").toggleClass("open-menu")
            })

            $("#logout-btn").click(() => {
                localStorage.clear()
                window.location.href = "../tech-index.html"
            })

            var categories = $("#categories")

            $.ajax({
                url: "https://localhost:7065/api/Category/GetTop5Category",
                method: "GET",
                contentType: "application/json",
                success: function (response) {
                    categories.append(
                        `<li class="nav-item">
                            <a class="nav-link" href="../tech-index.html">Home</a>
                        </li>`
                    )
                    categories.append(
                        response.map((cate) => (
                            `<li class="nav-item">
                                <a class="nav-link" href="../category/tech-category-01.html?cateId=${cate.id}">${cate.name}</a>
                            </li>`
                        ))
                    )
                    categories.append(
                        `<li class="nav-item">
                            <a class="nav-link" href="../category/tech-category-01.html">Tất Cả</a>
                        </li>`
                    )
                },
                error: function (xhr, status, error) {
                    SlimNotifierJs.notification('error', 'Error', xhr.responseText, 3000)
                },
            })

            $(".search-form").submit((event) => {
                event.preventDefault();
                var input = $("#mysearch").val()
                window.location.href = "../search/search-result.html?title=" + input;
            })
        })
    </script>
    <script src="../js/jwt-decode.js"></script>

</body>

</html>