<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Basic -->
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- Mobile Metas -->
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>

		<!-- Site Metas -->
		<title>Group 4 - News</title>
		<meta name="keywords" content="" />
		<meta name="description" content="" />
		<meta name="author" content="" />

		<!-- Site Icons -->
		<link
			rel="shortcut icon"
			href="../images/favicon.ico"
			type="../image/x-icon"
		/>
		<link rel="apple-touch-icon" href="../images/apple-touch-icon.png" />

		<!-- Design fonts -->
		<link
			href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700"
			rel="stylesheet"
		/>

		<!-- Bootstrap core CSS -->
		<link href="../css/bootstrap.css" rel="stylesheet" />

		<!-- FontAwesome Icons core CSS -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
			integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>

		<!-- Custom styles for this template -->
		<link href="../css/style.css" rel="stylesheet" />

		<!-- Responsive styles for this template -->
		<link href="../css/responsive.css" rel="stylesheet" />

		<!-- Colors for this template -->
		<link href="../css/colors.css" rel="stylesheet" />

		<!-- Version Tech CSS for this template -->
		<link href="../css/version/tech.css" rel="stylesheet" />

		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->

		<style>
			.post-img {
				height: 230px !important;
			}
		</style>
	</head>

	<body>
		<!-- Nhúng header -->
		<div id="header"></div>

		<div id="wrapper">
			<div class="page-title lb single-wrapper">
				<div class="container">
					<div class="row">
						<div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
							<h2 id="author-name"></h2>
						</div>
						<!-- end col -->
					</div>
					<!-- end row -->
				</div>
				<!-- end container -->
			</div>
			<!-- end page-title -->

			<section class="section">
				<div class="container">
					<div class="row">
						<div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
							<div class="page-wrapper">
								<div
									class="custombox authorbox clearfix"
									id="authorInfo"
								>
									<h4 class="small-title">About author</h4>
								</div>
								<!-- end author-box -->
							</div>
						</div>
					</div>
				</div>
			</section>
			<section class="section">
				<div class="container">
					<div class="row">
						<div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
							<div class="sidebar">
								<div class="widget">
									<div class="banner-spot clearfix">
										<div class="banner-img">
											<img
												src="https://solution.com.vn/upload_images/images/14/banner%20queenland-01.jpg"
												alt=""
												class="img-fluid"
											/>
										</div>
										<!-- end banner-img -->
									</div>
									<!-- end banner -->
								</div>
								<!-- end widget -->

								<div class="widget">
									<h2 class="widget-title">Popular Posts</h2>
									<div
										id="popular-post"
										class="trend-videos"
									></div>
									<!-- end videos -->
								</div>
								<!-- end widget -->

								<div class="widget">
									<h2 class="widget-title">Follow Us</h2>

									<div class="row text-center">
										<div
											class="col-lg-3 col-md-3 col-sm-3 col-xs-6"
										>
											<a
												href="#"
												class="social-button facebook-button"
											>
												<i class="fa fa-facebook"></i>
												<p>27k</p>
											</a>
										</div>

										<div
											class="col-lg-3 col-md-3 col-sm-3 col-xs-6"
										>
											<a
												href="#"
												class="social-button twitter-button"
											>
												<i class="fa fa-twitter"></i>
												<p>98k</p>
											</a>
										</div>

										<div
											class="col-lg-3 col-md-3 col-sm-3 col-xs-6"
										>
											<a
												href="#"
												class="social-button google-button"
											>
												<i
													class="fa fa-google-plus"
												></i>
												<p>17k</p>
											</a>
										</div>

										<div
											class="col-lg-3 col-md-3 col-sm-3 col-xs-6"
										>
											<a
												href="#"
												class="social-button youtube-button"
											>
												<i class="fa fa-youtube"></i>
												<p>22k</p>
											</a>
										</div>
									</div>
								</div>
								<!-- end widget -->

								<div class="widget">
									<div class="banner-spot clearfix">
										<div class="banner-img">
											<img
												src="https://uploads-ssl.webflow.com/6073fad993ae97919f0b0772/609fa687874b84361fc495db_%C4%91t.jpg"
												alt=""
												class="img-fluid"
											/>
										</div>
										<!-- end banner-img -->
									</div>
									<!-- end banner -->
								</div>
								<!-- end widget -->
							</div>
							<!-- end sidebar -->
						</div>

						<div id="loading-data" class="loading-div">
							<img src="../images/loader.gif" />
						</div>

						<div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
							<div class="page-wrapper">
								<div class="blog-grid-system">
									<div id="post-list" class="row"></div>
									<!-- end row -->
								</div>
								<!-- end blog-grid-system -->
							</div>
							<!-- end page-wrapper -->

							<hr class="invis3" />

							<div class="row">
								<div class="col-md-12">
									<nav aria-label="Page navigation">
										<ul
											id="pagination"
											class="pagination justify-content-start"
										></ul>
									</nav>
								</div>
								<!-- end col -->
							</div>
							<!-- end row -->
						</div>
					</div>
					<!-- end row -->
				</div>
				<!-- end container -->
			</section>

			<!-- Nhúng footer -->
			<div id="footer"></div>
			<div class="dmtop">Scroll to Top</div>
		</div>
		<!-- end wrapper -->

		<!-- Core JavaScript
    ================================================== -->
		<script src="../js/jquery.min.js"></script>
		<script src="../js/tether.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../js/custom.js"></script>
		<script src="../js/slim_notifier.js"></script>

		<script>
			$(() => {
				$("#header").load("../Utils/header.html");
				$("#footer").load("../Utils/footer.html");
			});

			function truncate(str, n) {
				return str.length > n ? str.slice(0, n - 1) + "&hellip;" : str;
			}

			var urlParam = new URLSearchParams(window.location.search);
			var attributeValue = urlParam.get("creatorId");

			console.log(attributeValue);
			$(document).ready(() => {
				$.ajax({
					url:
						"https://localhost:7065/api/Author/getAuthorById?id=" +
						attributeValue,
					method: "GET",
					contentType: "application/json",
					success: function (response) {
						console.log(response);
						$("#authorInfo").append(
							`     <div class="row">
                                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                                        <img src="../images/${response?.authorAvatar}" alt="" class="img-fluid rounded-circle">
                                    </div><!-- end col -->

                                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-12">
                                        <h4><a href="#">${response?.authorDisplayName}</a></h4>
                                        <p>Quisque sed tristique felis. Lorem <a href="#">visit my website</a> amet,
                                            consectetur adipiscing elit. Phasellus quis mi auctor, tincidunt nisl eget,
                                            finibus odio. Duis tempus elit quis risus congue feugiat. Thanks for stop
                                            Tech Blog!</p>

                                        <div class="topsocial">
                                            <a href="#" data-toggle="tooltip" data-placement="bottom"
                                                title="Facebook"><i class="fa fa-facebook"></i></a>
                                            <a href="#" data-toggle="tooltip" data-placement="bottom" title="Youtube"><i
                                                    class="fa fa-youtube"></i></a>
                                            <a href="#" data-toggle="tooltip" data-placement="bottom"
                                                title="Pinterest"><i class="fa fa-pinterest"></i></a>
                                            <a href="#" data-toggle="tooltip" data-placement="bottom" title="Twitter"><i
                                                    class="fa fa-twitter"></i></a>
                                            <a href="#" data-toggle="tooltip" data-placement="bottom"
                                                title="Instagram"><i class="fa fa-instagram"></i></a>
                                            <a href="#" data-toggle="tooltip" data-placement="bottom" title="Website"><i
                                                    class="fa fa-link"></i></a>
                                        </div><!-- end social -->

                                    </div><!-- end col -->
                                </div><!-- end row -->
                                `
						);
						var authorName = $("#author-name");
						authorName.append(
							`<i class="fa fa-star bg-orange" ></i> Author by: ${response?.authorDisplayName}`
						);
					},
					error: function (xhr, status, error) {
						SlimNotifierJs.notification(
							"error",
							"Error",
							xhr.responseText,
							3000
						);
					},
				});
			});

			$(document).ready(() => {
				$.ajax({
					url: "https://localhost:7065/api/Post/GetPopularPosts",
					method: "GET",
					contentType: "application/json",
					success: function (response) {
						$("#popular-post").append(
							response.map(
								(post) =>
									`<div class="blog-box">
                                <div class="post-media">
                                    <a href="../post/tech-single.html?id=${post.id}" title="">
                                        <img src="${
											post.image
										}" alt="" class="img-fluid">
                                        <div class="hovereffect">
                                            <span class="videohover"></span>
                                        </div>
                                    </a>
                                </div>
                                <div class="blog-meta">
                                    <h4><a href="../post/tech-single.html?id=${post.id}" title="">${truncate(
										post.title,
										50
									)}</a></h4>
                                </div>
                            </div>

                            <hr class="invis">`
							)
						);
					},
					error: function (xhr, status, error) {
						SlimNotifierJs.notification(
							"error",
							"Error",
							xhr.responseText,
							3000
						);
					},
				});

				$(document).ajaxStart(() => {
					$("#loading-data").show();
				});

				$(document).ajaxStop(() => {
					$("#loading-data").hide();
				});

				var page = 1;
				var pageSize = 10;

				loadDataWithCate();
				function loadDataWithCate() {
					$.ajax({
						url:
							"https://localhost:7065/api/Author/getAllPostAuthorById?id=" +
							attributeValue +
							"&page=" +
							page +
							"&pageSize=" +
							pageSize,
						method: "GET",
						contentType: "application/json",
						success: function (response) {
							var data = response.posts;
							var totalPages = response.totalPages;
							var postList = $("#post-list");
							postList.empty();
							postList.append(
								data.map(
									(post) =>
										`<div class="col-md-6">
											<div class="blog-box">
												<div class="post-media">
													<a href="../post/tech-single.html?id=${post.id}" title="">
														<img src="${post.image}" alt="${post.title}" class="img-fluid post-img">
														<div class="hovereffect">
															<span></span>
														</div>
													</a>
												</div>
												<div class="blog-meta big-meta">
													<span class="color-orange"><a href="../category/tech-category-01.html?cateId=${post.categoryId}" title="">${post.categoryName}</a></span>
													<h4><a href="../post/tech-single.html?id=${post.id}" title="">${post.title}</a></h4>
													<p>${post.description}</p>
													<small><a href="../post/tech-single.html?id=${post.id}" title="">${post.createdAt}</a></small>
													<small><a href="../author/tech-author.html?creatorId=${post.creatorId}" title="">by ${post.creatorName}</a></small>
													<small><a href="../post/tech-single.html?id=${post.id}" title=""><i class="fa fa-eye"></i> ${post.viewsCount}</a></small>
												</div>
											</div>
										</div>`
										)
							);

							var pagination = $("#pagination");
							pagination.empty();

							var startPage = Math.max(1, page - 2);
							var endPage = Math.min(startPage + 4, totalPages);

							if (startPage > 1) {
								pagination.append(
									`<li class="page-item"><a class="page-link">...</a></li>`
								);
							}

							for (var i = startPage; i <= endPage; i++) {
								pagination.append(
									`<li class="page-item"><a class="page-link">${i}</a></li>`
								);
							}

							if (endPage < totalPages) {
								pagination.append(
									`<li class="page-item"><a class="page-link">...</a></li>`
								);
							}

							pagination.on("click", "a", function () {
								var clickedPage = parseInt($(this).text());

								if (isNaN(clickedPage)) {
									if ($(this).text() === "...") {
										if ($(this).parent().index() === 0) {
											page = Math.max(1, page - 5);
										} else {
											page = Math.min(
												page + 5,
												totalPages
											);
										}
									}
								} else {
									page = clickedPage;
								}

								loadDataWithCate();
							});
						},
						error: function (xhr, status, error) {
							SlimNotifierJs.notification(
								"error",
								"Error",
								xhr.responseText,
								3000
							);
						},
					});
				}

				function loadAllPost() {
					$.ajax({
						url:
							"https://localhost:7065/api/Post/GetAllPost?page=" +
							page +
							"&pageSize=" +
							pageSize,
						method: "GET",
						contentType: "application/json",
						success: function (response) {
							var data = response.posts;
							var totalPages = response.totalPages;
							var postList = $("#post-list");
							postList.empty();
							postList.append(
								data.map(
									(post) =>
										`<div class="col-md-6">
                                    <div class="blog-box">
                                        <div class="post-media">
                                            <a href="../post/tech-single.html" title="">
                                                <img src="${post.image}" alt="${post.title}" class="img-fluid post-img">
                                                <div class="hovereffect">
                                                    <span></span>
                                                </div>
                                            </a>
                                        </div>
                                        <div class="blog-meta big-meta">
                                            <span class="color-orange"><a href="../post/tech-category-01.html" title="">${post.categoryName}</a></span>
                                            <h4><a href="../post/tech-single.html" title="">${post.title}</a></h4>
                                            <p>${post.description}</p>
                                            <small><a href="../post/tech-single.html" title="">${post.createdAt}</a></small>
                                            <small><a href="../tech-author.html" title="">by ${post.creatorName}</a></small>
                                            <small><a href="../post/tech-single.html" title=""><i class="fa fa-eye"></i> ${post.viewsCount}</a></small>
                                        </div>
                                    </div>
                                </div>`
								)
							);

							var pagination = $("#pagination");
							pagination.empty();

							var startPage = Math.max(1, page - 2);
							var endPage = Math.min(startPage + 4, totalPages);

							if (startPage > 1) {
								pagination.append(
									`<li class="page-item"><a class="page-link">...</a></li>`
								);
							}

							for (var i = startPage; i <= endPage; i++) {
								pagination.append(
									`<li class="page-item"><a class="page-link">${i}</a></li>`
								);
							}

							if (endPage < totalPages) {
								pagination.append(
									`<li class="page-item"><a class="page-link">...</a></li>`
								);
							}

							pagination.on("click", "a", function () {
								var clickedPage = parseInt($(this).text());

								if (isNaN(clickedPage)) {
									if ($(this).text() === "...") {
										if ($(this).parent().index() === 0) {
											page = Math.max(1, page - 5);
										} else {
											page = Math.min(
												page + 5,
												totalPages
											);
										}
									}
								} else {
									page = clickedPage;
								}

								loadAllPost();
							});
						},
						error: function (xhr, status, error) {
							SlimNotifierJs.notification(
								"error",
								"Error",
								xhr.responseText,
								3000
							);
						},
					});
				}

				if (attributeValue !== null) {
					loadDataWithCate();
				} else {
					loadAllPost();
				}
			});
		</script>
	</body>
</html>
